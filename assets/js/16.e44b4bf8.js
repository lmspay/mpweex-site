(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{237:function(t,s,a){t.exports=a.p+"assets/img/pay_diagrams.95c092c9.png"},252:function(t,s,a){"use strict";a.r(s);var n=[function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"_1-开通支付"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-开通支付","aria-hidden":"true"}},[this._v("#")]),this._v(" 1. 开通支付")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("如果小程序需要集成统一聚合支付，则需要在"),s("code",[this._v("小程序商户平台")]),this._v("进行支付签约。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"_2-小程序支付流程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-小程序支付流程","aria-hidden":"true"}},[this._v("#")]),this._v(" 2. 小程序支付流程")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("img",{attrs:{src:a(237),alt:"小程序支付流程图"}})])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"_2-1-创建支付通信通道"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-创建支付通信通道","aria-hidden":"true"}},[this._v("#")]),this._v(" 2.1 创建支付通信通道")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("code",[this._v("小程序")]),this._v("与"),s("code",[this._v("收银台")]),this._v("之间通信，需要创建一个专属的通信通道，可通过以下方式创建")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" payChannel "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("BroadcastChannel")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'sysPayChannel'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\npayChannel"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onmessage")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("e")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"origin: "')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("JSON")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("stringify")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"_2-2-拉起收银台"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-拉起收银台","aria-hidden":"true"}},[this._v("#")]),this._v(" 2.2 拉起收银台")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("strong",[this._v("示例代码")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" sys "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" weex"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("requireModule")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'sys'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nsys"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("pay")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'orderDesc'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'这是一个测试订单1'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'totalAmount'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'channelName'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'sysPayChannel'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("ret")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("ret"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ok"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\tmodal"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("toast")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("message"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"参数非法, orderDesc, totalAmount, channelName必填"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"_2-3-收银台创建通信通道"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-收银台创建通信通道","aria-hidden":"true"}},[this._v("#")]),this._v(" 2.3 收银台创建通信通道")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"_2-4-返回支付渠道、支付令牌"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-返回支付渠道、支付令牌","aria-hidden":"true"}},[this._v("#")]),this._v(" 2.4 返回支付渠道、支付令牌")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("用户在收银台选择完支付渠道，点击收银台中的"),s("code",[this._v("确认支付")]),this._v("按钮后，会通过通信通道通知小程序。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("strong",[this._v("消息参数：")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ul",[a("li",[a("code",[t._v("cmd")]),t._v("：固定值payChannelSelected")]),t._v(" "),a("li",[a("code",[t._v("channel")]),t._v("：支付渠道\n"),a("ul",[a("li",[a("code",[t._v("wx.appPreOrder")]),t._v("：表示微信")]),t._v(" "),a("li",[a("code",[t._v("trade.precreate")]),t._v("：表示支付宝")]),t._v(" "),a("li",[a("code",[t._v("uac.appOrder")]),t._v("：表示云闪付")]),t._v(" "),a("li",[a("code",[t._v("applepay.order")]),t._v("：表示ApplePay")])])]),t._v(" "),a("li",[a("code",[t._v("paytoken")]),t._v("： 支付令牌，创建订单时，需要传给小程序开放平台，令牌校验失败则会拒绝本次交易")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("strong",[this._v("传递内容示例")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("payChannel"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("postMessage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'cmd'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'payChannelSelected'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'channel'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'wx.appPreOrder'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'paytoken'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'_ROVplmq8J0hdiF2FjtexbVS-N2zA0S_TvZjqkmEV4vea_GKyMewutD4xwkExVZXDFqGMqhZm9cq76ITSayJYPoFgvxdUrgBdLfUqBQANGtaDTvem8Rs31Jum-BTe7-Y'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"_2-5-创建订单"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-5-创建订单","aria-hidden":"true"}},[this._v("#")]),this._v(" 2.5 创建订单")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("小程序在接收到收银台的支付渠道及支付令牌后，则调用自己的订单系统进行下单，订单系统需要向"),s("code",[this._v("小程序开放平台")]),this._v("下单，然后将订单信息通过"),s("code",[this._v("通信通道")]),this._v("返回给收银台")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("strong",[this._v("接收收银台消息示例")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("payChannel"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onmessage")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("e")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"origin: "')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("JSON")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("stringify")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" data "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'payChannelSelected'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'cmd'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 支付渠道选择完成，去下单")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// sample code")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("onPayChannelSelected")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'channel'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'paytoken'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"_2-6-传递订单信息至收银台"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-6-传递订单信息至收银台","aria-hidden":"true"}},[this._v("#")]),this._v(" 2.6 传递订单信息至收银台")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("strong",[this._v("消息参数：")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ul",[a("li",[a("code",[t._v("cmd")]),t._v("：固定值orderCreated")]),t._v(" "),a("li",[a("code",[t._v("result")]),t._v("：success表示下单成功，fail表示下单失败")]),t._v(" "),a("li",[a("code",[t._v("channel")]),t._v("：支付渠道\n"),a("ul",[a("li",[a("code",[t._v("wx.appPreOrder")]),t._v("：表示微信")]),t._v(" "),a("li",[a("code",[t._v("trade.precreate")]),t._v("：表示支付宝")]),t._v(" "),a("li",[a("code",[t._v("uac.appOrder")]),t._v("：表示云闪付")]),t._v(" "),a("li",[a("code",[t._v("applepay.order")]),t._v("：表示ApplePay")])])]),t._v(" "),a("li",[a("code",[t._v("appPayRequest")]),t._v("： 订单信息中的appPayRequest，当result为success时存在")]),t._v(" "),a("li",[a("code",[t._v("message")]),t._v("：当result为fail时，用于告之收银台错误描述")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("strong",[this._v("传递内容示例")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 云闪付或AndroidPay订单")]),t._v("\npayChannel"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("postMessage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'cmd'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'orderCreated'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'result'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'success'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'channel'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'uac.appOrder'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'appPayRequest'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"tn"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"747349220915532638217"')]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"_2-7-跳转支付"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-7-跳转支付","aria-hidden":"true"}},[this._v("#")]),this._v(" 2.7 跳转支付")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"_2-8-用户选择是否完成支付"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-8-用户选择是否完成支付","aria-hidden":"true"}},[this._v("#")]),this._v(" 2.8 用户选择是否完成支付")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("由于收银台无法通过回调确定支付结果，故需要小程序自己通过"),s("code",[this._v("订单查询")]),this._v("接口确认支付结果。用户完成支付后，跳转回收银台，会弹出对话框，让用户选择是否完成支付。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"_2-9-传递用户选择结果、关闭收银台"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-9-传递用户选择结果、关闭收银台","aria-hidden":"true"}},[this._v("#")]),this._v(" 2.9 传递用户选择结果、关闭收银台")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("strong",[this._v("消息参数：")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[s("code",[this._v("cmd")]),this._v("：固定值payEnd")]),this._v(" "),s("li",[s("code",[this._v("errorCode")]),this._v("：success表示已完成付款，cancel表示付款遇到问题")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("strong",[this._v("传递内容示例")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("payChannel"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("postMessage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'cmd'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'payEnd'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'errorCode'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'success'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[s("strong",[this._v("success")]),this._v("：已完成付款，查询一次，如果结果为失败也需要跳转结果页，让用户可以主动查询结果，结果确认主动权交于用户")]),this._v(" "),s("li",[s("strong",[this._v("cancel")]),this._v("：付款遇到问题，至少查询一次支付结果，决定跳转逻辑")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"_3-错误处理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-错误处理","aria-hidden":"true"}},[this._v("#")]),this._v(" 3. 错误处理")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("strong",[this._v("消息参数：")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ul",[a("li",[a("code",[t._v("cmd")]),t._v("：固定值onError")]),t._v(" "),a("li",[a("code",[t._v("errorCode")]),t._v("：\n"),a("ul",[a("li",[a("code",[t._v("cancel")]),t._v("：用户主动取消")]),t._v(" "),a("li",[a("code",[t._v("generate pay token failed")]),t._v("：生成支付令牌失败")]),t._v(" "),a("li",[a("code",[t._v("connect broadcast channel failed")]),t._v("：建立支付通道失败")]),t._v(" "),a("li",[a("code",[t._v("channel unsupport")]),t._v("：暂不支持此支付渠道")]),t._v(" "),a("li",[a("code",[t._v("illegal channel")]),t._v("：非法的支付渠道")]),t._v(" "),a("li",[a("code",[t._v("app not installed")]),t._v("：根据支付渠道，提醒用户安装对应APP")]),t._v(" "),a("li",[a("code",[t._v("start pay error")]),t._v("：跳转支付失败")]),t._v(" "),a("li",[a("code",[t._v("get pay channel failed")]),t._v(": 获取支付渠道失败")])])]),t._v(" "),a("li",[a("code",[t._v("errorMessage")]),t._v("：错误描述")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("strong",[this._v("传递内容示例")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("payChannel"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("postMessage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'cmd'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'onError'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'channel'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'errorCode'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'cancel'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'errorMessage'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'交易取消'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])}],e=a(0),r=Object(e.a)({},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"content"},[t._m(0),t._v(" "),t._m(1),t._v(" "),t._m(2),t._v(" "),t._m(3),t._v(" "),t._m(4),t._v(" "),t._m(5),t._v(" "),t._m(6),a("p",[t._v("参见： "),a("router-link",{attrs:{to:"./../../dev/api/broadcast-channel.html"}},[t._v("BroadcastChannel")])],1),t._v(" "),t._m(7),t._v(" "),a("p",[t._v("拉起收银台，小程序在创建订单前，需要拉起收银台获取支付渠道及支付令牌。必须传递通信通道名、订单标题、订单金额。")]),t._v(" "),t._m(8),t._v(" "),t._m(9),a("p",[t._v("参见： "),a("router-link",{attrs:{to:"./../../dev/modules/sys.html#pay"}},[t._v("sys模块")])],1),t._v(" "),t._m(10),t._v(" "),a("p",[t._v("拉起收银台后，收银台会根据小程序传递的通信通道名，建立同名的BroadcastChannel，并展示支持的支付渠道供用户选择。")]),t._v(" "),t._m(11),t._v(" "),t._m(12),t._v(" "),t._m(13),t._v(" "),t._m(14),t._v(" "),t._m(15),t._v(" "),t._m(16),t._m(17),t._v(" "),t._m(18),t._v(" "),t._m(19),t._v(" "),t._m(20),t._m(21),t._v(" "),a("p",[t._v("小程序下单成功后，将订单信息传递给收银台")]),t._v(" "),t._m(22),t._v(" "),t._m(23),t._v(" "),t._m(24),t._v(" "),t._m(25),t._m(26),t._v(" "),a("p",[t._v("收银台在接收到订单信息后，进行处理后，跳转到相应的支付渠道，由用户完成付款。")]),t._v(" "),t._m(27),t._v(" "),t._m(28),t._v(" "),t._m(29),t._v(" "),a("p",[t._v("用户选择后，收银台会通知小程序")]),t._v(" "),t._m(30),t._v(" "),t._m(31),t._v(" "),t._m(32),t._v(" "),t._m(33),a("p",[t._v("小程序接收到结果后，建议进行如下处理：")]),t._v(" "),t._m(34),t._v(" "),t._m(35),t._v(" "),a("p",[t._v("收银台，如果发生错误时，会通知小程序")]),t._v(" "),t._m(36),t._v(" "),t._m(37),t._v(" "),t._m(38),t._v(" "),t._m(39)])},n,!1,null,null,null);s.default=r.exports}}]);